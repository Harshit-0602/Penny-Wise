<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      .contain {
        border: 5px solid black;
        padding: 5px;
        margin: 0px;
      }
      body {
        padding: 0px;
        margin: 0px;
        background-color: #dcf2f1;
      }
      a {
        color: whitesmoke;
        text-decoration: none;
      }
      h1 {
        margin: 0px;
      }
      .grid {
        margin-top: 0px;
        display: grid;
        grid-template-columns: 0.25fr 0.75fr;
        grid-template-rows: 35px 550px 50px;
        gap: 10px;
      }
      .first {
        height: 70px;
        border-radius: 10px 10px 0px 0px;
        background-color: #0f1035;
        color: white;
        text-align: center;
        padding-top: 20px;
      }
      .second {
        border-radius: 0px 0px 10px 10px;
        background-color: rgb(54, 84, 134);
        display: flex;
        gap: 100px;
        padding-left: 22%;
        padding-top: 0.5%;
        grid-column: span 2;
      }
      .one,
      .two,
      .three,
      .four {
        display: inline;
      }
      .one,
      .two,
      .three {
        margin-right: 75px;
      }
      .third
      {
        border-radius: 10px;
        background-color: rgb(127, 199, 217);
        text-align: center;
        padding: 5px;
      }
      .fourth{
        border-radius: 10px;
        background-color: rgb(127, 199, 217);
        text-align: center;
        padding: 5px;
        /* max-height: 550px;
        overflow: auto; */
      }
      .budgets {
        margin-top: 30px;
        display: grid;
        grid-template-columns: 1fr;
        grid-template-rows: repeat(5, 25px);
        gap: 5px;
        overflow:auto;
       max-height: 150px;
      }
      
      .budgets>div {
        background-color: #dcf2f1;
        border-radius: 10px;
        height: 25px; /* Set a fixed height for all inner divs */
  /* display: flex;
  align-items: center;
  justify-content: center; */
      }
      .propic {
        border-radius: 75%;
        background-image: url("data:image/png;base64, <%=profileImage %>");
        background-size: contain;
        background-position: center;
        margin: 30px 50px 20px 80px;
        height: 200px;
        width: 200px;
        background-color: #dcf2f1;
      }
      .profile{
        margin:5px -50px 10px 20px;
        display:block;
      }
      .picupload{
        display:flex;
        justify-content: center;
        gap: 0px;
      }
      .upload{
        padding: -20px;
        text-decoration: none;
        height: 20px;
        margin: 5px;
      }
      .upload::hover{
        background-color: #333837;
      }
      .sixth {
        border-radius: 10px;
        background-color: rgb(54, 84, 134);
        color: aliceblue;
        display: flex;
        justify-content: center;
        align-items: center;
        grid-column: span 2;
        /* margin-top: 10px; */
      }

      .contact,
      .email {
        margin-right: 30px;
      }
      .input {
        width: 100%;
        margin-bottom: 30px;
      }
      .entries {
        display: grid;
        grid-template-columns: 1fr;
        grid-template-rows: 50px 50px 50px 50px 50px 50px 50px 50px 50px 50px;
        gap: 5px;
        max-height: 510px;
        overflow: auto;
        padding: 10px;
        /* margin-bottom: 10px; */
      }
      .entries > div {
        background-color: #dcf2f1;
        color: #0f1035;
        border-radius: 10px;
        height: 50px;
         white-space: pre;
      }
    </style>
  </head>
  <body>
    <div class="contain">
      <div class="first card">
        <a href="/"><h1>PENNYWISE</h1></a>
      </div>
      <div class="grid">
        <div class="second card">
          <div class="one"><a href="/">HOME</a></div>
          <div class="two"><a href="/user/dashboard">DASHBOARD</a></div>
          <div class="three"><a href="/user/budget">NEW BUDGET</a></div>
          <div class="four"><a href="/user/login">SIGN IN</a></div>
        </div>
        <div class="third">
          <div class="propic"></div>
          <div class="picupload">
            <input type="file" class="profile" placeholder="Upload"/>
          <button type="submit" class="upload" onclick="uploadPic()">Upload</button>
          </div>
          <input id="input" type="text" placeholder="search for budget" />
          <div class="budgets">
            <!-- <div class="b">BUDGET -1</div>
            <div class="b">BUDGET -2</div>
            <div class="b">BUDGET -3</div>
            <div class="b">BUDGET -4</div> -->
          </div>
        </div>
        <div class="fourth">
          <div class="entries">
            <!-- <div class="e1">Date: 13/2/23 Expense: 400$ Name: clothes</div>
            <div class="e2">Date: 15/2/23 Expense: 40$ Name: burger</div>
            <div class="e3">Date: 23/2/23 Expense: 700$ Name: shoes</div>
            <div class="e4">Date: 1/3/23 Expense: 4005$ Name: house</div>
            <div class="e5">Date: 13/3/23 Expense: 4567$ Name: jwellery</div>
            <div class="e6">Date: 19/4/23 Expense: 400$ Name: scotch</div>
            <div class="e7">Date: 23/5/23 Expense: 890$ Name: car</div>
            <div class="e8">Date: 26/6/23 Expense: 90$ Name: fitness</div>
            <div class="e9">Date: 16/7/23 Expense: 100$ Name: gym fees</div>
            <div class="e10">Date:19/8/23 Expense: 930$ Name: kuch bhi</div>
            <div class="e10">Date:19/8/23 Expense: 930$ Name: kuch bhi</div>
            <div class="e10">Date:19/8/23 Expense: 930$ Name: kuch bhi</div>
            <div class="e10">Date:19/8/23 Expense: 930$ Name: kuch bhi</div> -->
          </div>
        </div>
        <div class="sixth">
          <div class="contact"><h4>CONTACT US --------</h4></div>
          <div class="email">
            <p><b>Email:</b> info@pennywise.com</p>
          </div>
          <div class="phone">
            <p><b>Phone:</b> 7268934567</p>
          </div>
        </div>
      </div>
    </div>
    <script>
      const budgetExist=JSON.parse('<%-JSON.stringify(budgetExist)%>')
      const user=JSON.parse('<%-JSON.stringify(user)%>')
      console.log(user);

      const displayExpenses=(id,cost,name,date)=>{
        const newdiv=document.createElement("div");
        const parent=document.querySelector(".entries");

        newdiv.id=id;
        newdiv.innerHTML=`Date : ${date[0]}\t\tTime : ${date[1]}\t\tName : ${name}\t\tCost : ${cost}`;
        // newdiv.innerHTML = `Date: ${date[0]}&emsp;Time: ${date[1]}&emsp;Name: ${name}&emsp;Cost: ${cost}`;
        // newdiv.innerHTML = `Date: ${date[0]}&nbsp;Time: ${date[1]}&nbsp;Name: ${name}&nbsp;Cost: ${cost}`;

        parent.appendChild(newdiv);
      }

      const formatDate = (date) => {
        const formattedDate = new Date(date);
        // console.log(typeof(formattedDate));
        return formattedDate.toLocaleString().split(", ");
        // console.log(newDate);
      }

      const insertExpense=(n)=>{
        const ex=user.budgets[n].expenses;
        for(let i=ex.length-1;i>=0;i--)
        {
            displayExpenses(ex[i]._id,ex[i].expenseCost,ex[i].expenseName,formatDate(ex[i].createdAt));
        }
      }

       const insertBudget=(id,name)=>{
        const newdiv=document.createElement("div");
        const parent=document.querySelector(".budgets");
        newdiv.id=id;
        newdiv.innerHTML=name;
        // newdiv.onclick=insertExpense(newdiv.id);
        newdiv.addEventListener("click",()=>{
          const entries=document.querySelector(".entries")
          entries.innerHTML="";
          insertExpense(newdiv.id);
        })
        parent.appendChild(newdiv);
      }

      for(let i=user.budgets.length-1;i>=0;i--)
      {
        insertBudget(i,user.budgets[i].budgetName);
      }

      const uploadPic=()=>{
        const profile=document.querySelector(".profile");
        if(profile.files[0])
        {
            const formdata=new FormData();
            const profileImage=profile.files[0];
            formdata.append('profileImage',profileImage);
            // console.log(profileImage);
            fetch('/user/profileImage',{
              method:'POST',
              body:formdata,
            })
            .then(response=>{
              response.json()
              window.location.reload();
            })
            .catch(err=>{
              console.log(err);
            })
        }
      }
    </script>
  </body>
</html>
