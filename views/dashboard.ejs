<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      .contain {
        border: 5px solid black;
        padding: 5px;
        margin: 0px;
      }
      body {
        padding: 0px;
        margin: 0px;
        background-color: #dcf2f1;
      }
      a {
        color: whitesmoke;
        text-decoration: none;
      }
      h1 {
        margin: 0px;
      }
      .grid {
        margin-top: 0px;
        display: grid;
        grid-template-columns: 0.25fr 0.75fr;
        grid-template-rows: 35px 550px 50px;
        gap: 10px;
      }
      .first {
        height: 70px;
        border-radius: 10px 10px 0px 0px;
        background-color: #0f1035;
        color: white;
        text-align: center;
        padding-top: 20px;
      }
      .second {
        border-radius: 0px 0px 10px 10px;
        background-color: rgb(54, 84, 134);
        display: flex;
        gap: 100px;
        padding-left: 22%;
        padding-top: 0.5%;
        grid-column: span 2;
      }
      .one,
      .two,
      .three,
      .four {
        display: inline;
      }
      .one,
      .two,
      .three {
        margin-right: 75px;
      }
      .third {
        border-radius: 10px;
        background-color: rgb(127, 199, 217);
        text-align: center;
        padding: 5px;
      }
      .fourth {
        border-radius: 10px;
        background-color: rgb(127, 199, 217);
        text-align: center;
        padding: 5px;
        /* max-height: 550px;
        overflow: auto; */
      }
      .budgets {
        margin-top: 30px;
        display: grid;
        grid-template-columns: 1fr;
        grid-template-rows: repeat(5, 25px);
        gap: 5px;
        overflow: auto;
        max-height: 150px;
        /* For Webkit Browsers (Chrome, Safari) */
        /* You may need to add similar styles for other browsers like Firefox */

        /* Track */
        &::-webkit-scrollbar {
          width: 5px;
        }

        /* Handle */
        &::-webkit-scrollbar-thumb {
          background-color: #0f0e1f; /* Change the color of the scrollbar handle */
          border-radius: 8px; /* Round the corners of the scrollbar handle */
        }

        /* Handle on hover */

        /* Track */

        /* Handle when it is dragging */
        &::-webkit-scrollbar-thumb:active {
          background-color: #333837; /* Change the color when dragging */
        }
      }

      .budgets > div {
        background-color: #dcf2f1;
        border-radius: 10px;
        height: 25px;
        display: flex;
        align-items: center;
        justify-content: center;
        /* margin-bottom: 5px; Set a fixed height for all inner divs */
        /* display: flex;
  align-items: center;
  justify-content: center; */
      }
      .budgets > div:hover {
        cursor: pointer;
      }
      .propic {
        border-radius: 75%;
        background-image: url("data:image/png;base64, <%=profileImage %>");
        background-size: contain;
        background-position: center;
        margin: 30px 50px 20px 80px;
        height: 225px;
        width: 200px;
        background-color: #dcf2f1;
      }
      .profile {
        margin: 5px -50px 10px 20px;
        display: block;
      }
      .picupload {
        display: flex;
        justify-content: center;
        gap: 0px;
      }
      .upload {
        padding: -20px;
        text-decoration: none;
        height: 20px;
        margin: 5px;
      }
      .upload::hover {
        background-color: #333837;
      }
      .sixth {
        border-radius: 10px;
        background-color: rgb(54, 84, 134);
        color: aliceblue;
        display: flex;
        justify-content: center;
        align-items: center;
        grid-column: span 2;
        /* margin-top: 10px; */
      }
      .contact,
      .email {
        margin-right: 30px;
      }
      .input {
        width: 100%;
        margin-bottom: 30px;
      }
      .entries {
        display: grid;
        grid-template-columns: 1fr;
        grid-template-rows: 50px 50px 50px 50px 50px 50px 50px 50px 50px;
        gap: 5px;
        max-height: 510px;
        overflow: auto;
        padding: 10px;
        /* For Webkit Browsers (Chrome, Safari) */
        /* You may need to add similar styles for other browsers like Firefox */

        /* Track */
        &::-webkit-scrollbar {
          width: 5px;
        }

        /* Handle */
        &::-webkit-scrollbar-thumb {
          background-color: #0f0e1f; /* Change the color of the scrollbar handle */
          border-radius: 8px; /* Round the corners of the scrollbar handle */
        }

        /* Handle on hover */

        /* Track */

        /* Handle when it is dragging */
        &::-webkit-scrollbar-thumb:active {
          background-color: #333837; /* Change the color when dragging */
        }
        /* margin-bottom: 10px; */
      }
      /* .entries > div {
        background-color: #dcf2f1;
        color: #0f1035;
        border-radius: 10px;
        height: 50px;
         white-space: pre;
      } */
      .entries > div {
        background-color: #dcf2f1;
        color: #0f1035;
        border-radius: 10px;
        height: 50px;
        white-space: pre;
        display: flex;
        align-items: center;
        justify-content: center;
        /* margin-bottom: 5px; Add margin for spacing between entries */
      }
    </style>
  </head>
  <body>
    <div class="contain">
      <div class="first card">
        <a href="/"><h1>PENNYWISE</h1></a>
      </div>
      <div class="grid">
        <div class="second card">
          <div class="one"><a href="/">HOME</a></div>
          <div class="two"><a href="/user/dashboard">DASHBOARD</a></div>
          <div class="three"><a href="/user/budget">NEW BUDGET</a></div>
          <div class="four"><a href="/user/logout">SIGN OUT</a></div>
        </div>
        <div class="third">
          <div class="propic"></div>
          <div class="picupload">
            <input type="file" class="profile" placeholder="Upload" />
            <button type="submit" class="upload" onclick="uploadPic()">
              Upload
            </button>
          </div>
          <!-- <input id="input" type="search" placeholder="search for budget" /> -->
          <div class="budgets">
            <!-- <div class="b">aaaaaaaaaaaaaaaaaaaa</div> -->
          </div>
        </div>
        <div class="fourth">
          <div class="entries">
            <!-- <div class="e1">Date: 13/2/23 Expense: 400$ Name: clothes</div> -->
          </div>
        </div>
        <div class="sixth">
          <div class="contact"><h4>CONTACT US --------</h4></div>
          <div class="email">
            <p><b>Email:</b> info@pennywise.com</p>
          </div>
          <div class="phone">
            <p><b>Phone:</b> 7268934567</p>
          </div>
        </div>
      </div>
    </div>
    <script>
      const budgetExist = JSON.parse("<%-JSON.stringify(budgetExist)%>");
      // const user = JSON.parse(("<%-JSON.stringify(user)%>"));
      const user=JSON.parse('<%-JSON.stringify(user)%>');
      console.log(user);

      const displayExpenses = (id, cost, name, date) => {
        const newdiv = document.createElement("div");
        const parent = document.querySelector(".entries");

        newdiv.id = id;
        newdiv.innerHTML = `Date : ${date[0]}\t\tTime : ${date[1]}\t\tName : ${name}\t\tCost : ${cost}`;

        // newdiv.innerHTML = `Date: ${date[0]}&emsp;Time: ${date[1]}&emsp;Name: ${name}&emsp;Cost: ${cost}`;
        // newdiv.innerHTML = `Date: ${date[0]}&nbsp;Time: ${date[1]}&nbsp;Name: ${name}&nbsp;Cost: ${cost}`;

        parent.appendChild(newdiv);
      };

      const formatDate = (date) => {
        const formattedDate = new Date(date);
        // console.log(typeof(formattedDate));
        return formattedDate.toLocaleString().split(", ");
        // console.log(newDate);
      };

      const insertExpense = (n) => {
        const ex = user.budgets[n].expenses;
        if (ex.length == 0) {
          document.querySelector(".entries").innerHTML =
            "<h1><b>No Expense Created</b></h1>";
        } else {
          for (let i = ex.length - 1; i >= 0; i--) {
            displayExpenses(
              ex[i]._id,
              ex[i].expenseCost,
              ex[i].expenseName,
              formatDate(ex[i].createdAt)
            );
          }
        }
      };

      //  const insertBudget=(id,name)=>{
      //   const newdiv=document.createElement("div");
      //   const parent=document.querySelector(".budgets");
      //   newdiv.id=id;
      //   newdiv.innerHTML=name;
      //   newdiv.className="budget";
      //   // newdiv.onclick=insertExpense(newdiv.id);
      //   newdiv.addEventListener("click",()=>{
      //     newdiv.style.backgroundColor="#bdb714";
      //     const budget=document.querySelector("div");
      //     budget.style.backgroundColor="#dcf2f1";
      //     const entries=document.querySelector(".entries")
      //     entries.innerHTML="";
      //     insertExpense(newdiv.id);
      //   })
      //   parent.appendChild(newdiv);
      // }
      const insertBudget = (id, name,date) => {
        const newdiv = document.createElement("div");
        const parent = document.querySelector(".budgets");
        newdiv.id = id;
        newdiv.innerHTML = name+" : "+date[0];
        newdiv.className = "budget";

        newdiv.addEventListener("click", () => {
          // Remove yellow background from any previously selected budget
          const selectedBudget = document.querySelector(".budget[selected]");
          if (selectedBudget) {
            selectedBudget.style.backgroundColor = "#dcf2f1";
            selectedBudget.style.color = "#0f1035";
            selectedBudget.removeAttribute("selected");
          }

          // Set yellow background for the newly clicked budget
          newdiv.style.backgroundColor = "#0f1035";
          newdiv.style.color = "#dcf2f1";
          newdiv.setAttribute("selected", "true");

          const entries = document.querySelector(".entries");
          entries.innerHTML = "";
          insertExpense(newdiv.id);
        });

        parent.appendChild(newdiv);
      };

      if (user.budgets.length == 0) {
        document.querySelector(".budgets").innerHTML =
          "<h1><b>No Budget Created</b></h1>";
        document.querySelector(".entries").innerHTML =
          "<h1><b>No Expense Created</b></h1>";
      } else {
        insertExpense(user.budgets.length - 1);
        for (let i = user.budgets.length - 1; i >= 0; i--) {
          insertBudget(i, user.budgets[i].budgetName,formatDate(user.budgets[i].createdAt));
        }
      }

      const uploadPic = () => {
        const profile = document.querySelector(".profile");
        if (profile.files[0]) {
          const formdata = new FormData();
          const profileImage = profile.files[0];
          formdata.append("profileImage", profileImage);
          // console.log(profileImage);
          fetch("/user/profileImage", {
            method: "POST",
            body: formdata,
          })
            .then((response) => {
              response.json();
              window.location.reload();
            })
            .catch((err) => {
              console.log(err);
            });
        }
      };
    </script>
  </body>
</html>
